(function(s,h){typeof exports=="object"&&typeof module<"u"?h(exports,require("@codemirror/basic-setup"),require("@codemirror/commands"),require("@codemirror/lang-html"),require("@codemirror/state"),require("@codemirror/theme-one-dark"),require("@codemirror/view"),require("@vue-interface/btn"),require("vue"),require("@codemirror/lint"),require("@heroicons/vue/24/outline"),require("@vue-interface/animate-css"),require("@vue-interface/btn-dropdown"),require("@codemirror/panel"),require("capsule-lint")):typeof define=="function"&&define.amd?define(["exports","@codemirror/basic-setup","@codemirror/commands","@codemirror/lang-html","@codemirror/state","@codemirror/theme-one-dark","@codemirror/view","@vue-interface/btn","vue","@codemirror/lint","@heroicons/vue/24/outline","@vue-interface/animate-css","@vue-interface/btn-dropdown","@codemirror/panel","capsule-lint"],h):(s=typeof globalThis<"u"?globalThis:s||self,h(s.CapsuleEditor={},s.CodemirrorBasicSetup,s.CodemirrorCommands,s.CodemirrorLangHtml,s.CodemirrorState,s.CodemirrorThemeOneDark,s.CodemirrorView,s.VueInterfaceBtn,s.Vue,s.CodemirrorLint,s.HeroiconsVue_24Outline,s.VueInterfaceAnimateCss,s.VueInterfaceBtnDropdown,s.CodemirrorPanel,s.CapsuleLint))})(this,function(s,h,N,_,g,I,l,$,t,y,f,b,F,E,A){"use strict";const M=t.defineComponent({components:{ArrowTopRightOnSquareIcon:f.ArrowTopRightOnSquareIcon},props:{error:{type:Object,required:!0}},computed:{url(){return this.error.rule.link}}}),ye="",C=(e,o)=>{const r=e.__vccOpts||e;for(const[n,i]of o)r[n]=i;return r},T={class:"capsule-editor-error"},L=["href"];function q(e,o,r,n,i,c){const a=t.resolveComponent("ArrowTopRightOnSquareIcon");return t.openBlock(),t.createElementBlock("div",T,[t.createElementVNode("code",null,[t.createElementVNode("span",null,t.toDisplayString(e.error.line)+","+t.toDisplayString(e.error.col)+" :: ("+t.toDisplayString(e.error.rule.id)+") "+t.toDisplayString(e.error.message),1),t.createElementVNode("a",{href:e.url,target:"_blank"},[t.createTextVNode(" Reference "),t.createVNode(a)],8,L)])])}const O=C(M,[["render",q]]),P=t.defineComponent({components:{AnimateCss:b.AnimateCss,Btn:$.Btn,BtnDropdown:F.BtnDropdown,ChevronLeftIcon:f.ChevronLeftIcon,ChevronRightIcon:f.ChevronRightIcon,EditorError:O,BugAntIcon:f.BugAntIcon,ExclamationTriangleIcon:f.ExclamationTriangleIcon,WrenchScrewdriverIcon:f.WrenchScrewdriverIcon},props:{saveButton:{type:Boolean,default:!0},saveButtonLabel:{type:String,default:"Save File"},view:{type:Object,default:void 0}},emits:["goto","update:modelValue","save"],data(){return{currentDiagnostic:void 0,direction:"up",diagnostics:[],fixedAllDiagnostics:!1,hasLinted:!1,showFooter:!1,showFooterContent:!1}},computed:{actions(){return this.currentDiagnostic?[].concat(this.currentDiagnostic.rule.actions).reverse().filter(({validate:e})=>!e||e(this.view,this.currentDiagnostic)):[]},index(){return Math.max(0,this.diagnostics.indexOf(this.currentDiagnostic))},totalDiagnostics(){return this.diagnostics.length}},watch:{currentDiagnostic(e,o){this.direction=this.index>this.diagnostics.indexOf(o)?"down":"up"},diagnostics(e,o){e.length?(this.hasLinted=!0,this.fixedAllDiagnostics=!1):!e.length&&o.length?(this.hasLinted=!0,this.currentDiagnostic=null,this.fixedAllDiagnostics=!0):e.length||(this.fixedAllDiagnostics=!0)}},updated(){!this.isEmpty()&&this.hasLinted&&(this.saveButton||!this.saveButton&&this.diagnostics.length)?(this.showFooter=!0,setTimeout(()=>this.showFooterContent=!0,200)):(this.showFooterContent=!1,setTimeout(()=>this.showFooter=!1,200))},methods:{findActiveDiagnostic(){return this.diagnostics.filter(e=>e.isActive).pop()},goto(e){e<0?e=this.diagnostics.length-1:e>this.diagnostics.length-1&&(e=0);const o=this.currentDiagnostic;this.currentDiagnostic=this.diagnostics[e],this.$emit("goto",this.currentDiagnostic,o)},isEmpty(){return this.view?this.view.state.doc.toString()==="":!1},compare(e,o){return!!e&&!!o&&e.from===o.from&&e.to===o.to&&e.rule.id===o.rule.id},update(e){this.diagnostics=e||[],this.hasLinted=!0,this.currentDiagnostic||(this.currentDiagnostic=this.diagnostics[this.index]),this.$emit("update:modelValue",this.diagnostics)},activate(e){const{from:o,to:r}=e.state.selection.main,n=this.diagnostics.filter(a=>o===r?a.from<=o&&a.to>=r:a.from>=o&&a.to<=r),i=this.diagnostics.find(a=>this.compare(a,this.currentDiagnostic)),c=Math.max(0,n.indexOf(this.currentDiagnostic));n.length?this.currentDiagnostic=n[c]:this.currentDiagnostic=i||this.diagnostics[this.index]},onClickAction(e,o){o.apply(this.view,e.from,e.to),y.forceLinting(this.view)}}}),Be="",R={key:0,class:"flex justify-between items-center w-full py-2"},W={class:"flex items-center w-full overflow-hidden relative gap-2"},j={class:"editor-footer-pager"},z={key:0},G={class:"editor-footer-diagnostic"},Q={class:"editor-footer-action"},U=["onClick"];function H(e,o,r,n,i,c){const a=t.resolveComponent("ChevronLeftIcon"),d=t.resolveComponent("btn"),m=t.resolveComponent("ChevronRightIcon"),V=t.resolveComponent("BugAntIcon"),p=t.resolveComponent("ExclamationTriangleIcon"),Ce=t.resolveComponent("editor-error"),D=t.resolveComponent("animate-css"),we=t.resolveComponent("WrenchScrewdriverIcon"),ke=t.resolveComponent("btn-dropdown");return t.openBlock(),t.createElementBlock("footer",{class:"editor-footer",style:t.normalizeStyle({minHeight:e.showFooter?void 0:0})},[t.createVNode(D,{name:"fade",duration:200},{default:t.withCtx(()=>[e.showFooterContent?(t.openBlock(),t.createElementBlock("div",R,[t.createElementVNode("div",W,[t.createElementVNode("div",j,[e.totalDiagnostics?(t.openBlock(),t.createElementBlock("div",z,[t.createVNode(d,{type:"button",variant:"link",onClick:o[0]||(o[0]=u=>e.goto(e.index-1))},{default:t.withCtx(()=>[t.createVNode(a,{class:"w-4 h-4"})]),_:1}),t.createElementVNode("span",null,t.toDisplayString(e.index+1)+" of "+t.toDisplayString(e.diagnostics.length),1),t.createVNode(d,{type:"button",variant:"link",onClick:o[1]||(o[1]=u=>e.goto(e.index+1))},{default:t.withCtx(()=>[t.createVNode(m,{class:"w-4 h-4"})]),_:1})])):t.createCommentVNode("",!0)]),e.currentDiagnostic?(t.openBlock(),t.createElementBlock("button",{key:0,type:"button",onClick:o[2]||(o[2]=u=>e.goto(e.index))},[e.currentDiagnostic.severity==="error"?(t.openBlock(),t.createBlock(V,{key:0,class:"w-6 h-6"})):t.createCommentVNode("",!0),e.currentDiagnostic.severity==="warning"?(t.openBlock(),t.createBlock(p,{key:1,class:"w-6 h-6"})):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0),t.createElementVNode("div",G,[t.createVNode(D,{name:"fade",duration:200,direction:e.direction,"leave-active-class":"position-absolute"},{default:t.withCtx(()=>[e.currentDiagnostic?(t.openBlock(),t.createBlock(Ce,{key:e.index,error:e.currentDiagnostic},null,8,["error"])):t.createCommentVNode("",!0)]),_:1},8,["direction"])])]),t.createElementVNode("div",Q,[t.renderSlot(e.$slots,"before-save-button"),t.renderSlot(e.$slots,"action-button",{},()=>[e.actions.length?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.actions.length===1?(t.openBlock(),t.createBlock(d,{key:0,type:"button",variant:"light",size:"sm",class:"flex items-center gap-2",onClick:o[3]||(o[3]=()=>e.onClickAction(e.currentDiagnostic,e.actions[0]))},{default:t.withCtx(()=>[t.createVNode(we,{class:"w-6 h-6"}),t.createTextVNode(" "+t.toDisplayString(e.actions[0].name),1)]),_:1})):(t.openBlock(),t.createBlock(ke,{key:1,label:"Fix Errors",type:"button",size:"sm",variant:"light",dropup:""},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.actions,(u,$e)=>(t.openBlock(),t.createElementBlock("button",{key:`${e.currentDiagnostic.rule.id}-${$e}`,type:"button",variant:"light",onClick:()=>e.onClickAction(e.currentDiagnostic,u)},t.toDisplayString(u.name),9,U))),128))]),_:1}))],64)):t.createCommentVNode("",!0)]),t.renderSlot(e.$slots,"save-button",{diagnostics:e.diagnostics,saveButtonLabel:e.diagnostics},()=>[e.saveButton&&!e.diagnostics.length?(t.openBlock(),t.createBlock(d,{key:0,type:"button",variant:"light",size:"sm",onClick:o[4]||(o[4]=u=>e.$emit("save"))},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(e.saveButtonLabel),1)]),_:1})):t.createCommentVNode("",!0)]),t.renderSlot(e.$slots,"after-save-button",{diagnostics:e.diagnostics})])])):t.createCommentVNode("",!0)]),_:3})],4)}const J=C(P,[["render",H]]),K=t.defineComponent({components:{AnimateCss:b.AnimateCss},props:{bgAnimation:{type:Object,default:()=>({name:"fade",duration:500})},contentAnimation:{type:Object,default:()=>({name:"fade",duration:500})}},data:()=>({mounted:!1,isContentShowing:!1,showContent:!1}),watch:{showContent(e){e&&this.$nextTick(()=>{this.isContentShowing=!0})}},mounted(){this.mounted=!0}}),Ve="",Y={key:0,class:"capsule-editor-modal"},X={key:0,class:"capsule-editor-modal-content"};function Z(e,o,r,n,i,c){const a=t.resolveComponent("animate-css");return t.openBlock(),t.createBlock(a,t.mergeProps(e.bgAnimation,{onAfterEnter:o[0]||(o[0]=d=>e.showContent=!0)}),{default:t.withCtx(()=>[e.mounted?(t.openBlock(),t.createElementBlock("div",Y,[t.createVNode(a,t.normalizeProps(t.guardReactiveProps(e.contentAnimation)),{default:t.withCtx(()=>[e.showContent?(t.openBlock(),t.createElementBlock("div",X,[t.renderSlot(e.$slots,"default",{isShowing:e.isContentShowing})])):t.createCommentVNode("",!0)]),_:3},16)])):t.createCommentVNode("",!0)]),_:3},16)}const v=C(K,[["render",Z]]),x=t.defineComponent({components:{Btn:$.Btn,QuestionMarkCircleIcon:f.QuestionMarkCircleIcon},model:{prop:"currentValue"},props:{demoMode:Boolean,disableFilename:Boolean,filename:{type:String,default:void 0}},emits:["demo-modal","update:filename"],data(){return{currentValue:this.filename}}}),be="",ee={class:"editor-toolbar"},te={class:"editor-toolbar-left"},oe={class:"editor-toolbar-title"},ne=["disabled"],re={class:"editor-toolbar-right"};function ie(e,o,r,n,i,c){const a=t.resolveComponent("QuestionMarkCircleIcon"),d=t.resolveComponent("btn");return t.openBlock(),t.createElementBlock("div",ee,[t.createElementVNode("div",te,[t.renderSlot(e.$slots,"left")]),t.createElementVNode("div",oe,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=m=>e.currentValue=m),type:"text",placeholder:"Untitled Document",disabled:e.disableFilename,onInput:o[1]||(o[1]=m=>e.$emit("update:filename",m.target.value))},null,40,ne),[[t.vModelText,e.currentValue]])]),t.createElementVNode("div",re,[t.renderSlot(e.$slots,"right",{},()=>[e.demoMode?(t.openBlock(),t.createBlock(d,{key:0,size:"sm",variant:"link",class:"editor-help",onClick:o[2]||(o[2]=m=>e.$emit("demo-modal"))},{default:t.withCtx(()=>[t.createVNode(a,{class:"w-4 h-4"})]),_:1})):t.createCommentVNode("",!0)])])])}const se=C(x,[["render",ie]]);y.lintKeymap[0].run=()=>{};class S extends l.WidgetType{constructor(o){super(),this.diagnostic=o,this.diagnostic=o}line(o){this.diagnostic.line=o}col(o){this.diagnostic.col=o}from(o){this.diagnostic.from=o}to(o){this.diagnostic.to=o}eq(o){return o.diagnostic==this.diagnostic}toDOM(){return document.createElement("span")}ignoreEvent(){return!1}}class w{constructor(o){this.decorations=o,this.decorations=o}get length(){return this.decorations.length}get diagnostics(){const o=[];return this.iter(r=>{o.push(r.value)}),o.reduce((r,{widget:n})=>(r.indexOf(n.diagnostic)===-1&&r.push(n.diagnostic),r),[])}map(o){return this.decorations.map(o)}iter(o){const r=this.decorations.iter();for(;r.value;)o(r),r.next()}sync(o){const r=[];return this.iter(n=>{if(n.value.spec.side)n.value.widget.to(n.to);else{const i=o.doc.lineAt(n.from);n.value.widget.col(n.from-i.from+1),n.value.widget.from(n.from),n.value.widget.line(i.number)}r.push(n.value)}),r.reduce((n,{widget:i})=>(n.indexOf(i.diagnostic)===-1&&n.push(i.diagnostic),n),[])}static init(o){const r=o.map(n=>{const i=l.Decoration.widget({widget:new S(n),diagnostic:n,side:0}).range(n.from),c=l.Decoration.widget({widget:new S(n),diagnostic:n,side:1,from:i}).range(n.to);return[i,c]});return new w(l.Decoration.set(r.flat(),!0))}}const B=g.StateEffect.define(),k=g.StateField.define({create(){return new w(l.Decoration.none)},update(e,o){if(o.docChanged&&e.length)return new w(e.map(o.changes));for(const r of o.effects)if(r.is(B))return w.init(r.value);return e},provide(e){return[y.linter(o=>{const{doc:r}=o.state.toJSON(),n=A.lint(r).map(i=>{const c=o.state.doc.line(i.line),a=Math.min(r.length,c.from-1+i.col),d=Math.min(r.length,a+i.raw.length);return{from:a,to:d,col:i.col,line:i.line,rule:i.rule,message:i.message,severity:i.type,source:i.rule.id}});return o.dispatch({effects:B.of(n)}),n}),l.EditorView.decorations.from(e,o=>o.decorations),l.EditorView.updateListener.of(o=>{o.docChanged&&o.state.field(k).sync(o.view.state)})]}});function ae(e){return[k,E.showPanel.of(()=>({bottom:!0,dom:e.$refs.footer.$el})),l.EditorView.updateListener.of(o=>{if(e.$refs.footer){o.docChanged&&e.$refs.footer.update(o.state.field(k).diagnostics);for(const r of o.transactions)for(const n of r.effects)n.is(B)&&e.$refs.footer.update(o.state.field(k).diagnostics);e.$refs.footer.activate(o)}})]}function le(e){return[l.ViewPlugin.fromClass(class{constructor(o){e.currentContent=o.state.doc.toString()}}),l.EditorView.updateListener.of(o=>{o.docChanged&&(e.currentContent=o.state.doc.toString())}),E.showPanel.of(()=>({top:!0,dom:e.$refs.toolbar.$el}))]}const de=t.defineComponent({components:{Btn:$.Btn,EditorFooter:J,EditorModal:v,EditorToolbar:se},props:{content:{type:String,default:void 0},demoMode:{type:Boolean,default:!1},disableFilename:Boolean,filename:{type:String,default:null},save:{type:Function,default(){return this.showFinishModal=!0}},saveButton:{type:Boolean,default:!0},skipIntro:{type:Boolean,default:!1},title:{type:String,default:void 0},toolbar:{type:Boolean,default:!0}},emits:["demo-complete","fixed-errors","update:content","update:filename"],data(){return{demoModalCleared:this.skipIntro,errors:[],hasDismissedFinishPopup:!1,showFinishModal:!1,view:void 0}},watch:{errors(e,o){!e.length&&o.length&&this.$emit("fixed-errors")}},mounted(){this.view=new l.EditorView({state:h.EditorState.create({doc:this.content,extensions:[I.oneDark,...h.basicSetup,l.keymap.of([N.indentWithTab]),_.html(),this.toolbar&&le(this),ae(this),l.EditorView.lineWrapping,l.EditorView.updateListener.of(e=>{e.docChanged&&this.$emit("update:content",e.state.doc.toString())})].filter(e=>!!e)}),parent:this.$refs.wrapper})},methods:{closeFinishPopup(){this.showFinishModal=!1,this.hasDismissedFinishPopup=!0},onModalClear(){this.demoModalCleared=!0,this.$emit("demo-complete"),this.view.focus()},onGoto({from:e,to:o}){this.view.dispatch({selection:g.EditorSelection.create([g.EditorSelection.range(e,o),g.EditorSelection.cursor(o)]),scrollIntoView:!0}),this.view.focus()},onSave(){this.save(this)}}}),Ee="",ce={class:"capsule-editor"},me={class:"text-center"},fe=t.createElementVNode("h1",null," Success! ",-1),pe=t.createElementVNode("h5",null," Your document has been fixed. ",-1),he={ref:"wrapper",class:"cm-wrapper"};function ue(e,o,r,n,i,c){const a=t.resolveComponent("btn"),d=t.resolveComponent("editor-modal"),m=t.resolveComponent("editor-toolbar"),V=t.resolveComponent("editor-footer");return t.openBlock(),t.createElementBlock("div",ce,[e.showFinishModal?(t.openBlock(),t.createBlock(d,{key:0,"content-animation":{name:"tada"}},{default:t.withCtx(({isShowing:p})=>[t.renderSlot(e.$slots,"success",{close:e.closeFinishPopup,filename:e.filename,view:e.view,isShowing:p},()=>[t.renderSlot(e.$slots,"success-content",{content:e.content,close:e.closeFinishPopup,filename:e.filename,view:e.view},()=>[t.createElementVNode("div",me,[fe,pe,t.createVNode(a,{type:"button",variant:"primary",size:"lg",block:"",onClick:e.closeFinishPopup},{default:t.withCtx(()=>[t.createTextVNode(" Dismiss ")]),_:1},8,["onClick"])])])])]),_:3})):t.createCommentVNode("",!0),e.toolbar?(t.openBlock(),t.createBlock(m,{key:1,ref:"toolbar","demo-mode":e.demoMode,"disable-filename":e.disableFilename,filename:e.filename,onDemoModal:o[0]||(o[0]=()=>e.demoModalCleared=!1),"onUpdate:filename":o[1]||(o[1]=p=>e.$emit("update:filename",p))},{left:t.withCtx(()=>[t.renderSlot(e.$slots,"toolbar-left",{errors:e.errors,filename:e.filename,content:e.content})]),right:t.withCtx(()=>[t.renderSlot(e.$slots,"toolbar-right",{errors:e.errors,filename:e.filename,content:e.content})]),_:3},8,["demo-mode","disable-filename","filename"])):t.createCommentVNode("",!0),t.createElementVNode("div",he,null,512),t.createVNode(V,{ref:"footer",modelValue:e.errors,"onUpdate:modelValue":o[2]||(o[2]=p=>e.errors=p),"save-button":e.saveButton,view:e.view,onSave:e.onSave,onGoto:e.onGoto},{"before-save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"before-save-button",{errors:e.errors,filename:e.filename,content:e.content})]),"save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"save-button",{errors:e.errors,filename:e.filename,content:e.content})]),"after-save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"after-save-button",{errors:e.errors,filename:e.filename,content:e.content})]),_:3},8,["modelValue","save-button","view","onSave","onGoto"])])}const ge=C(de,[["render",ue]]);s.Editor=ge,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=capsule-editor.umd.cjs.map
