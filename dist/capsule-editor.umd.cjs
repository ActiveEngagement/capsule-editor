(function(a,h){typeof exports=="object"&&typeof module<"u"?h(exports,require("@codemirror/basic-setup"),require("@codemirror/lang-html"),require("@codemirror/theme-one-dark"),require("@codemirror/view"),require("@vue-interface/btn"),require("vue"),require("@codemirror/lint"),require("@heroicons/vue/24/outline"),require("@vue-interface/animate-css"),require("@vue-interface/btn-dropdown"),require("@codemirror/panel"),require("@codemirror/state"),require("capsule-lint")):typeof define=="function"&&define.amd?define(["exports","@codemirror/basic-setup","@codemirror/lang-html","@codemirror/theme-one-dark","@codemirror/view","@vue-interface/btn","vue","@codemirror/lint","@heroicons/vue/24/outline","@vue-interface/animate-css","@vue-interface/btn-dropdown","@codemirror/panel","@codemirror/state","capsule-lint"],h):(a=typeof globalThis<"u"?globalThis:a||self,h(a.CapsuleEditor={},a.CodemirrorBasicSetup,a.CodemirrorLangHtml,a.CodemirrorThemeOneDark,a.CodemirrorView,a.VueInterfaceBtn,a.Vue,a.CodemirrorLint,a.HeroiconsVue_24Outline,a.VueInterfaceAnimateCss,a.VueInterfaceBtnDropdown,a.CodemirrorPanel,a.CodemirrorState,a.CapsuleLint))})(this,function(a,h,N,F,l,k,t,$,p,V,_,b,E,I){"use strict";const A=t.defineComponent({components:{ArrowTopRightOnSquareIcon:p.ArrowTopRightOnSquareIcon},props:{error:{type:Object,required:!0}},computed:{url(){return this.error.rule.link}}}),$e="",g=(e,o)=>{const r=e.__vccOpts||e;for(const[n,i]of o)r[n]=i;return r},M={class:"capsule-editor-error"},T=["href"];function L(e,o,r,n,i,d){const s=t.resolveComponent("ArrowTopRightOnSquareIcon");return t.openBlock(),t.createElementBlock("div",M,[t.createElementVNode("code",null,[t.createElementVNode("span",null,t.toDisplayString(e.error.line)+","+t.toDisplayString(e.error.col)+" :: ("+t.toDisplayString(e.error.rule.id)+") "+t.toDisplayString(e.error.message),1),t.createElementVNode("a",{href:e.url,target:"_blank"},[t.createTextVNode(" Reference "),t.createVNode(s)],8,T)])])}const q=g(A,[["render",L]]),O=t.defineComponent({components:{AnimateCss:V.AnimateCss,Btn:k.Btn,BtnDropdown:_.BtnDropdown,ChevronLeftIcon:p.ChevronLeftIcon,ChevronRightIcon:p.ChevronRightIcon,EditorError:q,BugAntIcon:p.BugAntIcon,ExclamationTriangleIcon:p.ExclamationTriangleIcon,WrenchScrewdriverIcon:p.WrenchScrewdriverIcon},props:{saveButton:{type:Boolean,default:!0},saveButtonLabel:{type:String,default:"Save File"},view:{type:Object,default:void 0}},emits:["goto","update:modelValue","save"],data(){return{currentDiagnostic:void 0,direction:"up",diagnostics:[],fixedAllDiagnostics:!1,hasLinted:!1,showFooter:!1,showFooterContent:!1}},computed:{actions(){return this.currentDiagnostic?[].concat(this.currentDiagnostic.rule.actions).reverse().filter(({validate:e})=>!e||e(this.view,this.currentDiagnostic)):[]},index(){return Math.max(0,this.diagnostics.indexOf(this.currentDiagnostic))},totalDiagnostics(){return this.diagnostics.length}},watch:{currentDiagnostic(e,o){this.direction=this.index>this.diagnostics.indexOf(o)?"down":"up"},diagnostics(e,o){e.length?(this.hasLinted=!0,this.fixedAllDiagnostics=!1):!e.length&&o.length?(this.hasLinted=!0,this.currentDiagnostic=null,this.fixedAllDiagnostics=!0):e.length||(this.fixedAllDiagnostics=!0)}},updated(){!this.isEmpty()&&this.hasLinted&&(this.saveButton||!this.saveButton&&this.diagnostics.length)?(this.showFooter=!0,setTimeout(()=>this.showFooterContent=!0,200)):(this.showFooterContent=!1,setTimeout(()=>this.showFooter=!1,200))},methods:{findActiveDiagnostic(){return this.diagnostics.filter(e=>e.isActive).pop()},goto(e){e<0?e=this.diagnostics.length-1:e>this.diagnostics.length-1&&(e=0);const o=this.currentDiagnostic;this.currentDiagnostic=this.diagnostics[e],this.$emit("goto",this.currentDiagnostic,o)},isEmpty(){return this.view?this.view.state.doc.toString()==="":!1},compare(e,o){return!!e&&!!o&&e.from===o.from&&e.to===o.to&&e.rule.id===o.rule.id},update(e){this.diagnostics=e||[],this.hasLinted=!0,this.currentDiagnostic||(this.currentDiagnostic=this.diagnostics[this.index]),this.$emit("update:modelValue",this.diagnostics)},activate(e){const{from:o,to:r}=e.state.selection.main,n=this.diagnostics.filter(s=>o===r?s.from<=o&&s.to>=r:s.from>=o&&s.to<=r),i=this.diagnostics.find(s=>this.compare(s,this.currentDiagnostic)),d=Math.max(0,n.indexOf(this.currentDiagnostic));n.length?this.currentDiagnostic=n[d]:this.currentDiagnostic=i||this.diagnostics[this.index]},onClickAction(e,o){o.apply(this.view,e.from,e.to),$.forceLinting(this.view)}}}),ye="",P={key:0,class:"flex justify-between items-center w-full py-2"},R={class:"flex items-center w-full overflow-hidden relative gap-2"},j={class:"editor-footer-pager"},z={key:0},W={class:"editor-footer-diagnostic"},Q={class:"editor-footer-action"},U=["onClick"];function H(e,o,r,n,i,d){const s=t.resolveComponent("ChevronLeftIcon"),c=t.resolveComponent("btn"),m=t.resolveComponent("ChevronRightIcon"),B=t.resolveComponent("BugAntIcon"),f=t.resolveComponent("ExclamationTriangleIcon"),ge=t.resolveComponent("editor-error"),D=t.resolveComponent("animate-css"),Ce=t.resolveComponent("WrenchScrewdriverIcon"),we=t.resolveComponent("btn-dropdown");return t.openBlock(),t.createElementBlock("footer",{class:"editor-footer",style:t.normalizeStyle({minHeight:e.showFooter?void 0:0})},[t.createVNode(D,{name:"fade",duration:200},{default:t.withCtx(()=>[e.showFooterContent?(t.openBlock(),t.createElementBlock("div",P,[t.createElementVNode("div",R,[t.createElementVNode("div",j,[e.totalDiagnostics?(t.openBlock(),t.createElementBlock("div",z,[t.createVNode(c,{type:"button",variant:"link",onClick:o[0]||(o[0]=u=>e.goto(e.index-1))},{default:t.withCtx(()=>[t.createVNode(s,{class:"w-4 h-4"})]),_:1}),t.createElementVNode("span",null,t.toDisplayString(e.index+1)+" of "+t.toDisplayString(e.diagnostics.length),1),t.createVNode(c,{type:"button",variant:"link",onClick:o[1]||(o[1]=u=>e.goto(e.index+1))},{default:t.withCtx(()=>[t.createVNode(m,{class:"w-4 h-4"})]),_:1})])):t.createCommentVNode("",!0)]),e.currentDiagnostic?(t.openBlock(),t.createElementBlock("button",{key:0,type:"button",onClick:o[2]||(o[2]=u=>e.goto(e.index))},[e.currentDiagnostic.severity==="error"?(t.openBlock(),t.createBlock(B,{key:0,class:"w-6 h-6"})):t.createCommentVNode("",!0),e.currentDiagnostic.severity==="warning"?(t.openBlock(),t.createBlock(f,{key:1,class:"w-6 h-6"})):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0),t.createElementVNode("div",W,[t.createVNode(D,{name:"fade",duration:200,direction:e.direction,"leave-active-class":"position-absolute"},{default:t.withCtx(()=>[e.currentDiagnostic?(t.openBlock(),t.createBlock(ge,{key:e.index,error:e.currentDiagnostic},null,8,["error"])):t.createCommentVNode("",!0)]),_:1},8,["direction"])])]),t.createElementVNode("div",Q,[t.renderSlot(e.$slots,"before-save-button"),t.renderSlot(e.$slots,"action-button",{},()=>[e.actions.length?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.actions.length===1?(t.openBlock(),t.createBlock(c,{key:0,type:"button",variant:"light",size:"sm",class:"flex items-center gap-2",onClick:o[3]||(o[3]=()=>e.onClickAction(e.currentDiagnostic,e.actions[0]))},{default:t.withCtx(()=>[t.createVNode(Ce,{class:"w-6 h-6"}),t.createTextVNode(" "+t.toDisplayString(e.actions[0].name),1)]),_:1})):(t.openBlock(),t.createBlock(we,{key:1,label:"Fix Errors",type:"button",size:"sm",variant:"light",dropup:""},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.actions,(u,ke)=>(t.openBlock(),t.createElementBlock("button",{key:`${e.currentDiagnostic.rule.id}-${ke}`,type:"button",variant:"light",onClick:()=>e.onClickAction(e.currentDiagnostic,u)},t.toDisplayString(u.name),9,U))),128))]),_:1}))],64)):t.createCommentVNode("",!0)]),t.renderSlot(e.$slots,"save-button",{diagnostics:e.diagnostics,saveButtonLabel:e.diagnostics},()=>[e.saveButton&&!e.diagnostics.length?(t.openBlock(),t.createBlock(c,{key:0,type:"button",variant:"light",size:"sm",onClick:o[4]||(o[4]=u=>e.$emit("save"))},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(e.saveButtonLabel),1)]),_:1})):t.createCommentVNode("",!0)]),t.renderSlot(e.$slots,"after-save-button",{diagnostics:e.diagnostics})])])):t.createCommentVNode("",!0)]),_:3})],4)}const J=g(O,[["render",H]]),K=t.defineComponent({components:{AnimateCss:V.AnimateCss},props:{bgAnimation:{type:Object,default:()=>({name:"fade",duration:500})},contentAnimation:{type:Object,default:()=>({name:"fade",duration:500})}},data:()=>({mounted:!1,isContentShowing:!1,showContent:!1}),watch:{showContent(e){e&&this.$nextTick(()=>{this.isContentShowing=!0})}},mounted(){this.mounted=!0}}),Be="",Y={key:0,class:"capsule-editor-modal"},G={key:0,class:"capsule-editor-modal-content"};function X(e,o,r,n,i,d){const s=t.resolveComponent("animate-css");return t.openBlock(),t.createBlock(s,t.mergeProps(e.bgAnimation,{onAfterEnter:o[0]||(o[0]=c=>e.showContent=!0)}),{default:t.withCtx(()=>[e.mounted?(t.openBlock(),t.createElementBlock("div",Y,[t.createVNode(s,t.normalizeProps(t.guardReactiveProps(e.contentAnimation)),{default:t.withCtx(()=>[e.showContent?(t.openBlock(),t.createElementBlock("div",G,[t.renderSlot(e.$slots,"default",{isShowing:e.isContentShowing})])):t.createCommentVNode("",!0)]),_:3},16)])):t.createCommentVNode("",!0)]),_:3},16)}const Z=g(K,[["render",X]]),v=t.defineComponent({components:{Btn:k.Btn,QuestionMarkCircleIcon:p.QuestionMarkCircleIcon},model:{prop:"currentValue"},props:{demoMode:Boolean,disableFilename:Boolean,filename:{type:String,default:void 0}},emits:["demo-modal","update:modelValue"],data(){return{currentValue:this.filename}}}),Ve="",x={class:"editor-toolbar"},ee={class:"editor-toolbar-left"},te={class:"editor-toolbar-title"},oe=["disabled"],ne={class:"editor-toolbar-right"};function re(e,o,r,n,i,d){const s=t.resolveComponent("QuestionMarkCircleIcon"),c=t.resolveComponent("btn");return t.openBlock(),t.createElementBlock("div",x,[t.createElementVNode("div",ee,[t.renderSlot(e.$slots,"left")]),t.createElementVNode("div",te,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=m=>e.currentValue=m),type:"text",placeholder:"Untitled Document",disabled:e.disableFilename,onInput:o[1]||(o[1]=m=>e.$emit("update:modelValue",m.target.value))},null,40,oe),[[t.vModelText,e.currentValue]])]),t.createElementVNode("div",ne,[t.renderSlot(e.$slots,"right",{},()=>[e.demoMode?(t.openBlock(),t.createBlock(c,{key:0,size:"sm",variant:"link",class:"editor-help",onClick:o[2]||(o[2]=m=>e.$emit("demo-modal"))},{default:t.withCtx(()=>[t.createVNode(s,{class:"w-4 h-4"})]),_:1})):t.createCommentVNode("",!0)])])])}const ie=g(v,[["render",re]]);$.lintKeymap[0].run=()=>{};class S extends l.WidgetType{constructor(o){super(),this.diagnostic=o,this.diagnostic=o}line(o){this.diagnostic.line=o}col(o){this.diagnostic.col=o}from(o){this.diagnostic.from=o}to(o){this.diagnostic.to=o}eq(o){return o.diagnostic==this.diagnostic}toDOM(){return document.createElement("span")}ignoreEvent(){return!1}}class C{constructor(o){this.decorations=o,this.decorations=o}get length(){return this.decorations.length}get diagnostics(){const o=[];return this.iter(r=>{o.push(r.value)}),o.reduce((r,{widget:n})=>(r.indexOf(n.diagnostic)===-1&&r.push(n.diagnostic),r),[])}map(o){return this.decorations.map(o)}iter(o){const r=this.decorations.iter();for(;r.value;)o(r),r.next()}sync(o){const r=[];return this.iter(n=>{if(n.value.spec.side)n.value.widget.to(n.to);else{const i=o.doc.lineAt(n.from);n.value.widget.col(n.from-i.from+1),n.value.widget.from(n.from),n.value.widget.line(i.number)}r.push(n.value)}),r.reduce((n,{widget:i})=>(n.indexOf(i.diagnostic)===-1&&n.push(i.diagnostic),n),[])}static init(o){const r=o.map(n=>{const i=l.Decoration.widget({widget:new S(n),diagnostic:n,side:0}).range(n.from),d=l.Decoration.widget({widget:new S(n),diagnostic:n,side:1,from:i}).range(n.to);return[i,d]});return new C(l.Decoration.set(r.flat(),!0))}}const y=E.StateEffect.define(),w=E.StateField.define({create(){return new C(l.Decoration.none)},update(e,o){if(o.docChanged&&e.length)return new C(e.map(o.changes));for(const r of o.effects)if(r.is(y))return C.init(r.value);return e},provide(e){return[$.linter(o=>{const{doc:r}=o.state.toJSON(),n=I.lint(r).map(i=>{const d=o.state.doc.line(i.line),s=Math.min(r.length,d.from-1+i.col),c=Math.min(r.length,s+i.raw.length);return{from:s,to:c,col:i.col,line:i.line,rule:i.rule,message:i.message,severity:i.type,source:i.rule.id}});return o.dispatch({effects:y.of(n)}),n}),l.EditorView.decorations.from(e,o=>o.decorations),l.EditorView.updateListener.of(o=>{o.docChanged&&o.state.field(w).sync(o.view.state)})]}});function se(e){return[w,b.showPanel.of(()=>({bottom:!0,dom:e.$refs.footer.$el})),l.EditorView.updateListener.of(o=>{if(e.$refs.footer){o.docChanged&&e.$refs.footer.update(o.state.field(w).diagnostics);for(const r of o.transactions)for(const n of r.effects)n.is(y)&&e.$refs.footer.update(o.state.field(w).diagnostics);e.$refs.footer.activate(o)}})]}function ae(e){return[l.ViewPlugin.fromClass(class{constructor(o){e.currentContent=o.state.doc.toString()}}),l.EditorView.updateListener.of(o=>{o.docChanged&&(e.currentContent=o.state.doc.toString())}),b.showPanel.of(()=>({top:!0,dom:e.$refs.toolbar.$el}))]}const le=t.defineComponent({components:{Btn:k.Btn,EditorFooter:J,EditorModal:Z,EditorToolbar:ie},model:{prop:"currentContent"},props:{content:{type:String,default:void 0},demoMode:{type:Boolean,default:!1},disableFilename:Boolean,filename:{type:String,default:null},save:{type:Function,default(){return this.showFinishModal=!0}},saveButton:{type:Boolean,default:!0},skipIntro:{type:Boolean,default:!1},title:{type:String,default:void 0},toolbar:{type:Boolean,default:!0}},emits:["demo-complete","fixed-errors","update:modelValue"],data(){return{currentContent:this.content,currentFilename:this.filename,demoModalCleared:this.skipIntro,errors:[],hasDismissedFinishPopup:!1,showFinishModal:!1,view:void 0}},watch:{currentContent(){this.input()},currentFilename(){this.input()},errors(e,o){!e.length&&o.length&&this.$emit("fixed-errors")}},created(){},mounted(){this.view=new l.EditorView({state:h.EditorState.create({doc:this.currentContent,extensions:[F.oneDark,...h.basicSetup,N.html(),this.toolbar&&ae(this),se(this),l.EditorView.lineWrapping,l.EditorView.updateListener.of(e=>{e.docChanged&&(this.currentContent=e.state.doc.toString())})].filter(e=>!!e)}),parent:this.$refs.wrapper})},methods:{closeFinishPopup(){this.showFinishModal=!1,this.hasDismissedFinishPopup=!0},input(){this.$emit("update:modelValue",{content:this.currentContent,filename:this.currentFilename})},onModalClear(){this.demoModalCleared=!0,this.$emit("demo-complete"),this.view.focus()},onSave(){this.save(this)}}}),be="",ce={class:"capsule-editor"},de={class:"text-center"},me=t.createElementVNode("h1",null," Success! ",-1),pe=t.createElementVNode("h5",null," Your document has been fixed. ",-1),fe={ref:"wrapper",class:"cm-wrapper"};function he(e,o,r,n,i,d){const s=t.resolveComponent("btn"),c=t.resolveComponent("editor-modal"),m=t.resolveComponent("editor-toolbar"),B=t.resolveComponent("editor-footer");return t.openBlock(),t.createElementBlock("div",ce,[e.showFinishModal?(t.openBlock(),t.createBlock(c,{key:0,"content-animation":{name:"tada"}},{default:t.withCtx(({isShowing:f})=>[t.renderSlot(e.$slots,"success",{close:e.closeFinishPopup,filename:e.currentFilename,view:e.view,isShowing:f},()=>[t.renderSlot(e.$slots,"success-content",{content:e.currentContent,close:e.closeFinishPopup,filename:e.currentFilename,view:e.view},()=>[t.createElementVNode("div",de,[me,pe,t.createVNode(s,{type:"button",variant:"primary",size:"lg",block:"",onClick:e.closeFinishPopup},{default:t.withCtx(()=>[t.createTextVNode(" Dismiss ")]),_:1},8,["onClick"])])])])]),_:3})):t.createCommentVNode("",!0),e.toolbar?(t.openBlock(),t.createBlock(m,{key:1,ref:"toolbar",modelValue:e.currentFilename,"onUpdate:modelValue":o[0]||(o[0]=f=>e.currentFilename=f),"demo-mode":e.demoMode,"disable-filename":e.disableFilename,filename:e.currentFilename,onDemoModal:o[1]||(o[1]=()=>e.demoModalCleared=!1)},{left:t.withCtx(()=>[t.renderSlot(e.$slots,"toolbar-left",{errors:e.errors,filename:e.currentFilename,content:e.currentContent})]),right:t.withCtx(()=>[t.renderSlot(e.$slots,"toolbar-right",{errors:e.errors,filename:e.currentFilename,content:e.currentContent})]),_:3},8,["modelValue","demo-mode","disable-filename","filename"])):t.createCommentVNode("",!0),t.createElementVNode("div",fe,null,512),t.createVNode(B,{ref:"footer",modelValue:e.errors,"onUpdate:modelValue":o[2]||(o[2]=f=>e.errors=f),"save-button":e.saveButton,view:e.view,onSave:e.onSave},{"before-save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"before-save-button",{errors:e.errors,filename:e.currentFilename,content:e.currentContent})]),"save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"save-button",{errors:e.errors,filename:e.currentFilename,content:e.currentContent})]),"after-save-button":t.withCtx(()=>[t.renderSlot(e.$slots,"after-save-button",{errors:e.errors,filename:e.currentFilename,content:e.currentContent})]),_:3},8,["modelValue","save-button","view","onSave"])])}const ue=g(le,[["render",he]]);a.Editor=ue,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=capsule-editor.umd.cjs.map
