{"version":3,"file":"capsule-editor.js","sources":["../src/EditorError.vue","../src/EditorFooter.vue","../src/EditorModal.vue","../src/EditorToolbar.vue","../src/Extensions/Lint.ts","../src/Extensions/Toolbar.ts","../src/Editor.vue"],"sourcesContent":["<script lang=\"ts\">\nimport { ArrowTopRightOnSquareIcon } from '@heroicons/vue/24/outline';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\n    components: {\n        ArrowTopRightOnSquareIcon\n    },\n\n    props: {\n\n        error: {\n            type: Object,\n            required: true\n        }\n\n    },\n\n    computed: {\n        url() {\n            return this.error.rule.link;\n        }\n    }\n    \n});\n</script>\n\n<template>\n    <div class=\"capsule-editor-error\">\n        <code>\n            <span>{{ error.line }},{{ error.col }} :: ({{ error.rule.id }}) {{ error.message }}</span>\n            <a\n                :href=\"url\"\n                target=\"_blank\">\n                Reference <ArrowTopRightOnSquareIcon />\n            </a>\n        </code>            \n    </div>\n</template>\n\n<style>\n.capsule-editor-error {\n    display: flex;\n    align-items: center;\n    animation-duration: .5s;\n    padding: .5rem .75rem;\n    gap: .5rem;\n}\n\n.capsule-editor-error code {\n    padding: 0 .25rem;\n}\n\n.capsule-editor-error a {\n    font-size: .85rem;\n    color: #e0e0e0;\n    padding-left: .5rem;\n    display: inline-flex;\n    align-items: center;\n    gap: .5rem;\n}\n.capsule-editor-error a svg {\n    width: 1rem;\n    height: 1rem;\n}\n</style>\n","<script lang=\"ts\">\nimport { forceLinting } from '@codemirror/lint';\nimport { BugAntIcon, ChevronLeftIcon, ChevronRightIcon, ExclamationTriangleIcon, WrenchScrewdriverIcon } from '@heroicons/vue/24/outline';\nimport { AnimateCss } from '@vue-interface/animate-css';\nimport { Btn } from '@vue-interface/btn';\nimport { BtnDropdown } from '@vue-interface/btn-dropdown';\nimport { defineComponent } from 'vue';\nimport EditorError from './EditorError.vue';\n\nexport default defineComponent({\n    \n    components: {\n        AnimateCss,\n        Btn,\n        BtnDropdown,\n        ChevronLeftIcon,\n        ChevronRightIcon,\n        EditorError,\n        BugAntIcon,\n        ExclamationTriangleIcon,\n        WrenchScrewdriverIcon\n    },\n\n    props: {\n        saveButton: {\n            type: Boolean,\n            default: true\n        },\n\n        saveButtonLabel: {\n            type: String,\n            default: 'Save File'\n        },\n        \n        view: {\n            type: Object,\n            default: undefined\n        }\n    },\n\n    emits: [\n        'goto',\n        'update:modelValue',\n        'save'\n    ],\n\n    data() {\n        return {\n            currentDiagnostic: undefined,\n            direction: 'up',\n            diagnostics: [],\n            fixedAllDiagnostics: false,\n            hasLinted: false,\n            showFooter: false,\n            showFooterContent: false,\n        };\n    },\n\n    computed: {\n\n        actions() {\n            return this.currentDiagnostic ? []\n                .concat(this.currentDiagnostic.rule.actions)\n                .reverse()\n                .filter(({ validate }: { validate: Function }) => {\n                    return !validate || validate(this.view, this.currentDiagnostic);\n                }) : [];\n        },\n\n        index() {\n            return Math.max(0, this.diagnostics.indexOf(this.currentDiagnostic));\n        },\n\n        totalDiagnostics() {\n            return this.diagnostics.length;\n        }\n\n    },\n\n    watch: {\n\n        currentDiagnostic(value, oldValue) {\n            this.direction = this.index > this.diagnostics.indexOf(oldValue) ? 'down': 'up';\n        },\n\n        diagnostics(value, oldValue) {\n            if(value.length) {\n                this.hasLinted = true;\n                this.fixedAllDiagnostics = false;\n            }\n            else if(!value.length && !!oldValue.length) {\n                this.hasLinted = true;\n                this.currentDiagnostic = null;\n                this.fixedAllDiagnostics = true;\n            }\n            else if(!value.length) {\n                this.fixedAllDiagnostics = true;\n            }\n\n        }\n    },\n\n    updated() {\n        if(!this.isEmpty() && this.hasLinted && (this.saveButton || !this.saveButton && this.diagnostics.length)) {\n            this.showFooter = true;\n            setTimeout(() => this.showFooterContent = true, 200);\n        }\n        else {\n            this.showFooterContent = false;\n            setTimeout(() => this.showFooter = false, 200);\n        }\n    },\n\n    methods: {\n\n        findActiveDiagnostic() {\n            return this.diagnostics\n                .filter((diagnostic: any) => diagnostic.isActive)\n                .pop();\n        },\n\n        goto(index: number) {\n            if(index < 0) {\n                index = this.diagnostics.length - 1;\n            }\n            else if(index > this.diagnostics.length - 1) {\n                index = 0;\n            }\n\n            const lastDiagnostic = this.currentDiagnostic;\n            \n            this.currentDiagnostic = this.diagnostics[index];   \n\n            this.$emit('goto', this.currentDiagnostic, lastDiagnostic);\n        },\n\n        isEmpty() {\n            return this.view ? this.view.state.doc.toString() === '' : false;\n        },\n\n        compare(a: any, b: any) {\n            return (!!a && !!b)\n                && a.from === b.from\n                && a.to === b.to\n                && a.rule.id === b.rule.id;\n        },\n\n        update(diagnostics: any) {\n            this.diagnostics = diagnostics || [];\n            this.hasLinted = true;\n\n            if(!this.currentDiagnostic) {\n                this.currentDiagnostic = this.diagnostics[this.index];\n            }\n            \n            this.$emit('update:modelValue', this.diagnostics);\n        },\n        \n        activate(view: any) {\n            const { from, to } = view.state.selection.main;\n\n            const active = this.diagnostics.filter((diagnostic: any) => {\n                if(from === to) {\n                    return diagnostic.from <= from && diagnostic.to >= to;\n                }\n\n                return diagnostic.from >= from && diagnostic.to <= to;\n            });\n\n            const match = this.diagnostics.find((diagnostic: any) => {\n                return this.compare(diagnostic, this.currentDiagnostic);\n            });\n\n            const index = Math.max(0, active.indexOf(this.currentDiagnostic));\n            \n            if(active.length) {\n                this.currentDiagnostic = active[index];\n            }\n            else {\n                this.currentDiagnostic = match || this.diagnostics[this.index];\n            }\n        },\n\n        onClickAction(diagnostic: any, action: any) {\n            action.apply(this.view, diagnostic.from, diagnostic.to);\n\n            forceLinting(this.view);\n        }\n\n    }\n\n});\n</script>\n\n<template>\n    <footer\n        class=\"editor-footer\"\n        :style=\"{minHeight: !showFooter ? 0 : undefined}\">\n        <animate-css\n            name=\"fade\"\n            :duration=\"200\">\n            <div\n                v-if=\"showFooterContent\"\n                class=\"flex justify-between items-center w-full py-2\">\n                <div class=\"flex items-center w-full overflow-hidden relative gap-2\">\n                    <div class=\"editor-footer-pager\">\n                        <div v-if=\"totalDiagnostics\">\n                            <btn\n                                type=\"button\"\n                                variant=\"link\"\n                                @click=\"goto(index - 1)\">\n                                <ChevronLeftIcon class=\"w-4 h-4\" />\n                            </btn> \n                            <span>{{ index + 1 }} of {{ diagnostics.length }}</span>\n                            <btn\n                                type=\"button\"\n                                variant=\"link\"\n                                @click=\"goto(index + 1)\">\n                                <ChevronRightIcon class=\"w-4 h-4\" />\n                            </btn>\n                        </div>\n                    </div>\n                    <button\n                        v-if=\"currentDiagnostic\"\n                        type=\"button\"\n                        @click=\"goto(index)\">\n                        <BugAntIcon\n                            v-if=\"currentDiagnostic.severity === 'error'\"\n                            class=\"w-6 h-6\" />\n                                \n                        <ExclamationTriangleIcon\n                            v-if=\"currentDiagnostic.severity === 'warning'\"\n                            class=\"w-6 h-6\" />\n                    </button>\n                    <div class=\"editor-footer-diagnostic\">\n                        <animate-css\n                            name=\"fade\"\n                            :duration=\"200\"\n                            :direction=\"direction\"\n                            leave-active-class=\"position-absolute\">\n                            <editor-error\n                                v-if=\"currentDiagnostic\"\n                                :key=\"index\"\n                                :error=\"currentDiagnostic\" />\n                        </animate-css>\n                    </div>\n                </div>\n                <div class=\"editor-footer-action\">\n                    <slot name=\"before-save-button\" />\n\n                    <slot name=\"action-button\">\n                        <template v-if=\"actions.length\">\n                            <template v-if=\"actions.length === 1\">\n                                <btn\n                                    type=\"button\"\n                                    variant=\"light\"\n                                    size=\"sm\"\n                                    class=\"flex items-center gap-2\"\n                                    @click=\"() => onClickAction(currentDiagnostic, actions[0])\">\n                                    <WrenchScrewdriverIcon class=\"w-6 h-6\" /> {{ actions[0].name }}\n                                </btn>\n                            </template>\n                            <template v-else>\n                                <btn-dropdown\n                                    label=\"Fix Errors\"\n                                    type=\"button\"\n                                    size=\"sm\"\n                                    variant=\"light\"\n                                    dropup>\n                                    <button\n                                        v-for=\"(action, i) in actions\"\n                                        :key=\"`${currentDiagnostic.rule.id}-${i}`\"\n                                        type=\"button\"\n                                        variant=\"light\"\n                                        @click=\"() => onClickAction(currentDiagnostic, action)\">\n                                        {{ action.name }}\n                                    </button>\n                                </btn-dropdown>\n                            </template>\n                        </template>\n                    </slot>\n\n                    <slot\n                        name=\"save-button\"\n                        :diagnostics=\"diagnostics\"\n                        :save-button-label=\"diagnostics\">\n                        <btn\n                            v-if=\"saveButton && !diagnostics.length\"\n                            type=\"button\"\n                            variant=\"light\"\n                            size=\"sm\"\n                            @click=\"$emit('save')\">\n                            {{ saveButtonLabel }}\n                        </btn>\n                    </slot>\n\n                    <slot\n                        name=\"after-save-button\"\n                        :diagnostics=\"diagnostics\" />\n                </div>\n            </div>\n        </animate-css>\n    </footer>\n</template>\n\n<style>\n.editor-footer {\n    display: flex;\n    align-items: center;\n    color: white;\n    position: relative;\n    transition: .2s all ease-in;\n}\n\n.editor-footer-content {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    width: 100%;\n    padding: 1rem 0;\n}\n\n.editor-footer-error {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n}\n\n.editor-footer-icon {\n    margin-right: .5rem;\n}\n\n.editor-footer-icon button {\n    color: white;\n    padding: 0 1rem;\n}\n\n.editor-footer-icon button:active {\n    color: #e0e0e0;\n}\n\n.editor-footer-action {\n    flex-shrink: 0;\n    padding-right: .5rem;\n}\n\n.editor-footer-action-icon {\n    margin-right: .25rem;\n}\n\n.editor-footer-diagnostic {\n    font-weight: 300;\n    font-size: .85em;\n    overflow: hidden;\n}\n    \n.editor-footer-pager {\n    flex-shrink: 0;\n    min-width: 10.5rem;\n}\n\n.editor-footer-pager  > div {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 .5rem;\n}\n\n.editor-footer-pager .btn {\n    padding: 0;\n    color: white;\n    width: 2rem;\n    height: 1.75rem;\n    font-size: 1.75rem;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: .6666rem;\n    background: transparent;\n    border: 0;\n}\n\n.editor-footer-pager .btn:active {\n    background: rgba(0, 0, 0, .3);\n}\n</style>","<script lang=\"ts\">\nimport { AnimateCss } from '@vue-interface/animate-css';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n    components: {\n        AnimateCss\n    },\n    props: {\n        bgAnimation: {\n            type: Object,\n            default: () => ({\n                name: 'fade',\n                duration: 500\n            })\n        },\n        contentAnimation: {\n            type: Object,\n            default: () => ({\n                name: 'fade',\n                duration: 500\n            })\n        }\n    },\n    data: () => ({\n        mounted: false,\n        isContentShowing: false,\n        showContent: false,\n    }),\n    watch: {\n        showContent(value) {\n            if(value) {\n                this.$nextTick(() => {\n                    this.isContentShowing = true;\n                });\n            }\n        }\n    },\n    mounted() {\n        this.mounted = true;\n    },\n});\n</script>\n\n<template>\n    <animate-css\n        v-bind=\"bgAnimation\"\n        @after-enter=\"showContent = true\">\n        <div\n            v-if=\"mounted\"\n            class=\"capsule-editor-modal\">\n            <animate-css v-bind=\"contentAnimation\">\n                <div\n                    v-if=\"showContent\"\n                    class=\"capsule-editor-modal-content\">\n                    <slot :is-showing=\"isContentShowing\" />\n                </div>\n            </animate-css>\n        </div>\n    </animate-css>\n</template>\n\n<style>\n.capsule-editor-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 1000;\n    background: rgba(0, 0, 0, .3);\n}\n\n.capsule-editor-modal::after  {\n    content: '';\n    width: 100%;\n    height: 100%;\n    background: inherit; \n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: 2;\n    background: rgba(41, 91, 150, .8);\n    filter: blur(50rem);\n}\n\n.capsule-editor-modal h1 {\n    font-size: 2rem;\n}\n\n.capsule-editor-modal small, .capsule-editor-modal .small {\n    font-size: .75rem;\n}    \n\n.capsule-editor-modal h1 {\n    margin-bottom: 1rem;\n}\n\n.capsule-editor-modal h5 {\n    font-weight: 300;\n    margin-bottom: 1.5rem;\n    font-size: 1.25rem;\n}\n\n.capsule-editor-modal p {\n    margin-bottom: 1rem;\n}\n\n.capsule-editor-modal .capsule-editor-modal-text {\n    margin: 0 3rem 1rem;\n}\n\n.capsule-editor-modal a {\n    color: #0284c7;\n}\n\n.capsule-editor-modal .text-center { \n    text-align: center;\n}\n\n.capsule-editor-modal a:hover {\n    text-decoration: underline;\n}\n\n.capsule-editor-modal .font-light {\n    font-weight: 300;\n}\n\n.capsule-editor-modal-logo {\n    width: 6rem;\n    margin: 2rem auto;\n    display: flex;\n}\n\n.capsule-editor-modal-content {\n    width: 50%;\n    overflow: auto;\n    min-width: 33rem;\n    max-width: 40rem;\n    max-height: 40rem;\n    background: white;\n    box-shadow: 0 0 30px rgba(0, 0, 0, .5);\n    position: relative;\n    z-index: 10;\n    padding: 1rem;\n}\n\n.capsule-editor-modal .slide-deck-controls {\n    bottom: 1.75rem;\n}\n\n.capsule-editor-modal .slide-deck-control-icon {\n    font-size: .75rem;\n}\n\n.capsule-editor-modal .slide-deck-control-icon:not(.is-active) {\n    color: #e0e0e0;\n}\n\n.capsule-editor-modal-footer {\n    position: absolute;\n    left: 50%;\n    bottom: 0;\n    transform: translateX(-50%);\n}\n\n.capsule-editor-modal-action {\n    text-align: center;\n}\n\n.capsule-editor-modal-action .btn {\n    margin-bottom: .75rem;\n}\n\n.capsule-editor-modal-action small {\n    display: block;\n}\n</style>\n","<script lang=\"ts\">\nimport { QuestionMarkCircleIcon } from '@heroicons/vue/24/outline';\nimport { Btn } from '@vue-interface/btn';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\n    components: {\n        Btn,\n        QuestionMarkCircleIcon\n    },\n\n    model: {\n        prop: 'currentValue'\n    },\n\n    props: {\n\n        demoMode: Boolean,\n\n        disableFilename: Boolean,\n        \n        filename: {\n            type: String,\n            default: undefined\n        }\n\n    },\n\n    emits: [\n        'demo-modal',\n        'update:modelValue',\n    ],\n\n    data() {\n        return {\n            currentValue: this.filename\n        };\n    }\n\n});\n</script>\n\n<template>\n    <div class=\"editor-toolbar\">\n        <div class=\"editor-toolbar-left\">\n            <slot name=\"left\" />\n        </div>\n        <div class=\"editor-toolbar-title\">\n            <input\n                v-model=\"currentValue\"\n                type=\"text\"\n                placeholder=\"Untitled Document\"\n                :disabled=\"disableFilename\"\n                @input=\"(event: any) => $emit('update:modelValue', event.target.value)\">\n        </div>\n        <div class=\"editor-toolbar-right\">\n            <slot name=\"right\">\n                <btn\n                    v-if=\"demoMode\"\n                    size=\"sm\"\n                    variant=\"link\"\n                    class=\"editor-help\"\n                    @click=\"$emit('demo-modal')\">\n                    <QuestionMarkCircleIcon class=\"w-4 h-4\" />\n                </btn>\n            </slot>\n        </div>\n    </div>\n</template>\n\n<style>\n.editor-toolbar {\n    color: white;\n    background-color: #292C33 !important;\n    display: flex;\n    justify-content: space-between;\n    padding: .5rem .5rem .25rem;\n}\n\n.editor-toolbar.fixed {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    z-index: 100;\n}\n\n.editor-toolbar .btn {\n    position: relative;\n}\n\n.editor-toolbar .badge {\n    top: 0;\n    right: 0;\n    z-index: 1;\n    transform: translate(50%, -25%);\n}\n\n.editor-toolbar .btn.has-error > svg {\n    color: #9f1239;\n}\n\n.editor-toolbar-title {\n    font-size: 1em;\n    width: auto;\n    background: transparent;\n    text-align: center;\n    margin: 0 auto;\n    display: flex;\n    flex-grow: 1;\n}\n\n.editor-toolbar-title input {\n    border: 0;\n    margin: 0;\n    color: white;\n    outline: none;\n    background: transparent;\n    text-align: center;\n    flex-grow: 1;\n}\n\n.editor-help, .editor-help:hover {\n    font-size: 1.5em;\n    color: #228DFF;\n}\n\n.editor-toolbar-actions .dropdown-item {\n    display: flex;\n    align-items: center;\n}\n\n.editor-toolbar-actions .dropdown-item span {\n    margin-right: 1.5em;\n}\n\n.editor-toolbar-actions .dropdown-item code {\n    font-size: 8px;\n    margin-left: auto;\n}\n\n.editor-toolbar-actions .dropdown-item kbd {\n    background: rgb(60, 60, 60);\n}\n\n.editor-toolbar-actions .dropdown-item kbd:not(:last-child) {\n    margin-right: .25em;\n}\n\n.editor-toolbar-actions .dropdown-item svg {\n    width: 9px;\n}\n</style>\n","import { linter, lintKeymap } from '@codemirror/lint';\nimport { showPanel } from '@codemirror/panel';\nimport { StateEffect, StateField } from '@codemirror/state';\nimport { Decoration, EditorView, WidgetType } from '@codemirror/view';\nimport { lint } from 'capsule-lint';\n\n// Override the default keymaps\n// @ts-ignore\nlintKeymap[0].run = () => {\n    // Ignore the command\n};\n\nclass DiagnosticWidget extends WidgetType {\n    constructor(\n        public diagnostic: any\n    ) {\n        super();\n\n        this.diagnostic = diagnostic;\n    }\n    line(number: number) {\n        this.diagnostic.line = number;\n    }\n    col(number: number) {\n        this.diagnostic.col = number;\n    }\n    from(number: number) {\n        this.diagnostic.from = number;\n    }\n    to(number: number) {\n        this.diagnostic.to = number;\n    }\n    eq(other: any) {\n        return other.diagnostic == this.diagnostic;\n    }\n    toDOM() {\n        return document.createElement('span');\n    }\n    ignoreEvent() {\n        return false; \n    }\n}\n\nclass LintState {\n    constructor(\n        public decorations: any\n    ) {\n        this.decorations = decorations;\n    }\n    get length() {\n        return this.decorations.length;\n    }\n    get diagnostics() {\n        const items: any[] = [];\n        \n        this.iter((iter: any) => {\n            items.push(iter.value);\n        });\n\n        return items.reduce((carry, { widget }) => {\n            if(carry.indexOf(widget.diagnostic) === -1) {\n                carry.push(widget.diagnostic);\n            }\n\n            return carry;\n        }, []);\n    }\n    map(fn: Function) {\n        return this.decorations.map(fn);\n    }\n    iter(fn: Function) {\n        const iter = this.decorations.iter();\n        \n        while(iter.value) {\n            fn(iter);\n            \n            iter.next();\n        }\n    }\n    sync(state: any) {\n        const items: any[] = [];\n\n        this.iter((iter: any) => {\n            if(!iter.value.spec.side) {\n                const line = state.doc.lineAt(iter.from);\n                \n                iter.value.widget.col(iter.from - line.from + 1);\n                iter.value.widget.from(iter.from);\n                iter.value.widget.line(line.number);\n            }\n            else {\n                iter.value.widget.to(iter.to);\n            }\n\n            items.push(iter.value);\n        });\n\n        return items.reduce((carry, { widget }) => {\n            if(carry.indexOf(widget.diagnostic) === -1) {\n                carry.push(widget.diagnostic);\n            }\n\n            return carry;\n        }, []);\n    }\n    static init(diagnostics: any[]) {\n        const mapped = diagnostics.map(diagnostic => {\n            const from = Decoration.widget({\n                widget: new DiagnosticWidget(diagnostic),\n                diagnostic,\n                side: 0,\n            }).range(diagnostic.from);\n\n            const to = Decoration.widget({\n                widget: new DiagnosticWidget(diagnostic),\n                diagnostic,\n                side: 1,\n                from,\n            }).range(diagnostic.to);\n\n            return [\n                from,\n                to\n            ];\n        });\n\n        return new LintState(\n            Decoration.set(mapped.flat(), true)\n        );\n    }\n}\n\nconst setDiagnosticsEffect = StateEffect.define();\n\nconst lintState = StateField.define({\n    create() {\n        return new LintState(Decoration.none);\n    },\n    update(value, tr: any) {\n        if(tr.docChanged && value.length) {\n            return new LintState(value.map(tr.changes));\n        }\n\n        for(const effect of tr.effects) {\n            if(effect.is(setDiagnosticsEffect)) {\n                return LintState.init(effect.value);\n            }\n        }\n\n        return value;\n    },\n    provide(field) {\n        return [\n            linter(view => {\n                const { doc } = view.state.toJSON();\n            \n                const diagnostics = lint(doc).map((error: any) => {\n                    const pos = view.state.doc.line(error.line);\n                    const from  = Math.min(doc.length, pos.from - 1 + error.col);\n                    const to = Math.min(doc.length, from + error.raw.length);\n            \n                    return {\n                        from,\n                        to,\n                        col: error.col,\n                        line: error.line,\n                        rule: error.rule,\n                        message: error.message,\n                        severity: error.type,\n                        source: error.rule.id,\n                    };\n                });\n            \n                view.dispatch({\n                    effects: setDiagnosticsEffect.of(diagnostics)\n                });\n            \n                return diagnostics;\n            }),\n            EditorView.decorations.from(field, state => state.decorations),\n            EditorView.updateListener.of(event => {\n                if(event.docChanged) {\n                    event.state.field(lintState).sync(event.view.state);\n                }\n            })\n        ];\n    }\n});\n\nexport default function(parent: any) {\n    return [\n        lintState,\n        showPanel.of(() => {\n            return {\n                bottom: true,\n                dom: parent.$refs.footer.$el\n            };\n        }),\n        EditorView.updateListener.of(view => {   \n            if(!parent.$refs.footer) {\n                return;\n            }\n                 \n            if(view.docChanged) {\n                parent.$refs.footer.update(\n                    view.state.field(lintState).diagnostics\n                );\n            }\n\n            for(const tr of view.transactions) {\n                for(const effect of tr.effects) {\n                    if(effect.is(setDiagnosticsEffect)) {\n                        parent.$refs.footer.update(\n                            view.state.field(lintState).diagnostics\n                        );\n                    }\n                }\n            }\n\n            parent.$refs.footer.activate(view);\n        }),\n    ];\n}","import { showPanel } from '@codemirror/panel';\nimport { EditorView, ViewPlugin } from '@codemirror/view';\n\nexport default function(parent: any) {\n    return [\n        ViewPlugin.fromClass(class {\n            constructor(view: any) {\n                parent.currentContent = view.state.doc.toString();\n            }\n        }),\n        EditorView.updateListener.of(view => {\n            if(view.docChanged) {\n                parent.currentContent = view.state.doc.toString();\n            }\n        }),\n        showPanel.of(() => ({\n            top: true,\n            dom: parent.$refs.toolbar.$el\n        }))\n    ];\n}","<script lang=\"ts\">\nimport { basicSetup, EditorState } from '@codemirror/basic-setup';\nimport { html } from '@codemirror/lang-html';\nimport { oneDark } from '@codemirror/theme-one-dark';\nimport { EditorView } from '@codemirror/view';\nimport { Btn } from '@vue-interface/btn';\nimport { defineComponent } from 'vue';\nimport EditorFooter from './EditorFooter.vue';\nimport EditorModal from './EditorModal.vue';\nimport EditorToolbar from './EditorToolbar.vue';\nimport lint from './Extensions/Lint.js';\nimport toolbar from './Extensions/Toolbar.js';\n\nexport default defineComponent({\n    components: {\n        Btn,\n        EditorFooter,\n        EditorModal,\n        EditorToolbar,\n    },\n    model: {\n        prop: 'currentContent'\n    },\n    props: {\n        content: {\n            type: String,\n            default: undefined\n        },\n        \n        demoMode: {\n            type: Boolean,\n            default: false\n        },\n\n        disableFilename: Boolean,\n\n        filename: {\n            type: String,\n            default: null\n        },\n\n        save: {\n            type: Function,\n            default() {\n                return this.showFinishModal = true;\n            }\n        },\n\n        saveButton: {\n            type: Boolean,\n            default: true\n        },\n\n        skipIntro: {\n            type: Boolean,\n            default: false\n        },\n\n        title: {\n            type: String,\n            default: undefined\n        },\n\n        toolbar: {\n            type: Boolean,\n            default: true\n        },\n    },\n    emits: [\n        'demo-complete',\n        'fixed-errors',\n        'update:modelValue'\n    ],\n    data() {\n        return {\n            currentContent: this.content,\n            currentFilename: this.filename,\n            demoModalCleared: this.skipIntro,\n            errors: [],\n            hasDismissedFinishPopup: false,\n            showFinishModal: false,\n            view: undefined,\n        };\n    },\n    watch: {\n        currentContent() {\n            this.input();\n        },\n        currentFilename() {\n            this.input();\n        },\n        errors(value, oldErrors) {\n            if(!value.length && oldErrors.length) {\n                this.$emit('fixed-errors');\n            }\n        },\n        // showFinishModal(value) {\n        //     if(value) {\n        //         setTimeout(() => this.isSuccessModalShowing = true, 1000)\n        //     }\n        // }\n    },\n    created() {\n        // this.$on('finish', value => {\n        //     if(this.demoMode) {\n        //         this.showFinishModal = value;\n        //     }\n        // });\n    },\n    mounted() {\n        \n        this.view = new EditorView({\n            state: EditorState.create({\n                doc: this.currentContent,// || this.getSlotContents(),\n                extensions: [\n                    oneDark,\n                    ...basicSetup,\n                    // keymap.of([ indentWithTab ]),\n                    html(),\n                    this.toolbar && toolbar(this),\n                    lint(this),\n                    EditorView.lineWrapping,\n                    EditorView.updateListener.of(view => {\n                        if(view.docChanged) {\n                            this.currentContent = view.state.doc.toString();\n                        }\n                    })\n                ].filter(value => !!value)\n            }),\n            parent: this.$refs.wrapper\n        });\n    },\n    methods: {\n        closeFinishPopup() {\n            this.showFinishModal = false;\n            this.hasDismissedFinishPopup = true;\n        },\n\n        // getSlotContents() {\n        //     return this.$slots.default ? this.$slots.default().filter((vnode: any) => {\n        //         return vnode.tag && vnode.tag.toLowerCase() === 'textarea' && !!vnode.children;\n        //     }).reduce((carry: any, vnode: any) => {\n        //         return (\n        //             carry + vnode.children.map((child: any) => {\n        //                 return child.text;\n        //             }).join('')\n        //         );\n        //     }, '').trim() : null;\n        // },\n\n        input() {\n            this.$emit('update:modelValue', {\n                content: this.currentContent,\n                filename: this.currentFilename,\n            });\n        },\n\n        onModalClear() {\n            this.demoModalCleared = true;\n            this.$emit('demo-complete');\n            this.view.focus();\n        },\n        \n        // onGoto({ from, to }) {\n\n        //     console.log(from, to);\n        //     // const tr = this.view.state.update({\n        //     //     selection: {\n        //     //         anchor: from,\n        //     //         head: to\n        //     //     },\n        //     //     scrollIntoView: true\n        //     // });\n\n        //     // this.view.dispatch(tr);\n        //     // this.view.focus();\n        // },\n\n        onSave() {\n            this.save(this);\n        }\n    }\n});\n</script>\n\n<template>\n    <div class=\"capsule-editor\">\n        <!-- <editor-demo-modal\n            v-if=\"demoMode && !demoModalCleared\"\n            @clear=\"onModalClear\" /> -->\n\n        <editor-modal\n            v-if=\"showFinishModal\"\n            :content-animation=\"{name: 'tada'}\">\n            <template #default=\"{ isShowing }\">\n                <slot\n                    name=\"success\"\n                    :close=\"closeFinishPopup\"\n                    :filename=\"currentFilename\"\n                    :view=\"view\"\n                    :is-showing=\"isShowing\">\n                    <slot\n                        name=\"success-content\"\n                        :content=\"currentContent\"\n                        :close=\"closeFinishPopup\"\n                        :filename=\"currentFilename\"\n                        :view=\"view\">\n                        <div class=\"text-center\">\n                            <h1>\n                                Success!\n                            </h1>\n                            <h5>\n                                Your document has been fixed.\n                            </h5>\n                            <btn\n                                type=\"button\"\n                                variant=\"primary\"\n                                size=\"lg\"\n                                block\n                                @click=\"closeFinishPopup\">\n                                Dismiss\n                            </btn>\n                        </div>\n                    </slot>\n                </slot>\n            </template>\n        </editor-modal>\n\n        <editor-toolbar\n            v-if=\"toolbar\"\n            ref=\"toolbar\"\n            v-model=\"currentFilename\"\n            :demo-mode=\"demoMode\"\n            :disable-filename=\"disableFilename\"\n            :filename=\"currentFilename\"\n            @demo-modal=\"() => demoModalCleared = false\">\n            <template #left>\n                <slot\n                    name=\"toolbar-left\"\n                    :errors=\"errors\"\n                    :filename=\"currentFilename\"\n                    :content=\"currentContent\" />\n            </template>\n            <template #right>\n                <slot\n                    name=\"toolbar-right\"\n                    :errors=\"errors\"\n                    :filename=\"currentFilename\"\n                    :content=\"currentContent\" />\n            </template>\n        </editor-toolbar>\n\n        <div\n            ref=\"wrapper\"\n            class=\"cm-wrapper\" />\n\n        <editor-footer\n            ref=\"footer\"\n            v-model=\"errors\"\n            :save-button=\"saveButton\"\n            :view=\"view\"\n            @save=\"onSave\">\n            <template #before-save-button>\n                <slot\n                    name=\"before-save-button\"\n                    :errors=\"errors\"\n                    :filename=\"currentFilename\"\n                    :content=\"currentContent\" />\n            </template>\n            <template #save-button>\n                <slot\n                    name=\"save-button\"\n                    :errors=\"errors\"\n                    :filename=\"currentFilename\"\n                    :content=\"currentContent\" />\n            </template>\n            <template #after-save-button>\n                <slot\n                    name=\"after-save-button\"\n                    :errors=\"errors\"\n                    :filename=\"currentFilename\"\n                    :content=\"currentContent\" />\n            </template>\n        </editor-footer>\n    </div>\n</template>\n\n<style>\n.capsule-editor {\n    font-size: 1rem;\n}\n\n.capsule-editor .position-absolute {\n    position: absolute;\n}\n\n.capsule-editor,\n.cm-container,\n.cm-editor,\n.cm-wrapper { height: 100%; }\n.cm-scroller { overflow: auto }\n.cm-editor.cm-focused { outline: none }\n.cm-panels.cm-panels-top { border: none !important; }\n.cm-panels.cm-panels-bottom { border: 1px solid #101114 !important; }\n</style>\n"],"names":["_sfc_main$4","defineComponent","ArrowTopRightOnSquareIcon","_component_ArrowTopRightOnSquareIcon","_resolveComponent","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_toDisplayString","_ctx","_createTextVNode","_sfc_main$3","AnimateCss","Btn","BtnDropdown","ChevronLeftIcon","ChevronRightIcon","EditorError","BugAntIcon","ExclamationTriangleIcon","WrenchScrewdriverIcon","validate","value","oldValue","diagnostic","index","lastDiagnostic","a","b","diagnostics","view","from","to","active","match","action","forceLinting","_hoisted_4","_normalizeStyle","_component_animate_css","_withCtx","_hoisted_2","_hoisted_3","_createVNode","_component_btn","_cache","$event","_createCommentVNode","_createBlock","_component_BugAntIcon","_component_ExclamationTriangleIcon","_hoisted_5","_component_editor_error","_hoisted_6","_renderSlot","_Fragment","_component_WrenchScrewdriverIcon","_component_btn_dropdown","_renderList","i","_sfc_main$2","_normalizeProps","_guardReactiveProps","_sfc_main$1","QuestionMarkCircleIcon","_withDirectives","event","lintKeymap","DiagnosticWidget","WidgetType","number","other","LintState","decorations","items","iter","carry","widget","fn","state","line","mapped","Decoration","setDiagnosticsEffect","StateEffect","lintState","StateField","tr","effect","field","linter","doc","lint","error","pos","EditorView","parent","showPanel","toolbar","ViewPlugin","_sfc_main","EditorFooter","EditorModal","EditorToolbar","oldErrors","EditorState","oneDark","basicSetup","html","_component_editor_modal","isShowing","_component_editor_toolbar","_component_editor_footer"],"mappings":"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"}